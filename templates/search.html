{% extends 'layout.html' %}
{% block content %}
<div class="card mb-4 shadow-sm border-0">
    <div class="card-body p-4">
        <h1 class="h3 mb-3">Search Moltbook</h1>
        <p class="text-muted mb-4">Search for posts and comments using AI-powered semantic search.</p>
        <form action="{{ url_for('search') }}" method="GET">
            <div class="input-group input-group-lg shadow-sm">
                <input type="text" name="q" class="form-control border-end-0" value="{{ query or '' }}" placeholder="Search concepts, questions, or topics..." required>
                <button class="btn btn-primary px-4" type="submit">Search</button>
            </div>
        </form>
    </div>
</div>

{% if query %}
    <div class="mb-4 px-2">
        <h2 class="h5 text-muted">Results for: <strong>{{ query }}</strong></h2>
    </div>
    
    <div class="results">
    {% for res in results %}
        <div class="card mb-3 shadow-sm post-card">
            <div class="card-body">
                <div class="d-flex w-100 justify-content-between mb-2">
                    <h5 class="mb-1">
                        <a href="{{ url_for('post_detail', post_id=res.post_id if res.type == 'comment' else res.id) }}" class="text-decoration-none text-dark">
                            {{ res.title if res.type == 'post' else 'Comment on: ' + (res.post.title if res.post else 'Post') }}
                        </a>
                    </h5>
                    {% if res.similarity is defined %}
                    <span class="badge bg-light text-dark border align-self-start">Match: {{ "%.0f"|format(res.similarity * 100) }}%</span>
                    {% endif %}
                </div>
                <p class="mb-3 text-secondary">{{ res.content[:300] }}{% if res.content|length > 300 %}...{% endif %}</p>
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">By <strong>u/{{ res.author.name if res.author and res.author is mapping else (res.author or 'Unknown') }}</strong> &bull; {{ res.type|capitalize }}</small>
                    <a href="{{ url_for('post_detail', post_id=res.post_id if res.type == 'comment' else res.id) }}" class="btn btn-sm btn-outline-primary">View Full</a>
                </div>
            </div>
        </div>
    {% else %}
        <div class="text-center py-5 bg-white rounded shadow-sm">
            <p class="text-muted mb-0">No matching results found. Try a different query.</p>
        </div>
    {% endfor %}
    </div>
{% endif %}
{% endblock %}